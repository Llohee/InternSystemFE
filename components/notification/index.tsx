import { Menu, MenuButton, MenuItem } from '@headlessui/react'
import { MenuBar, MenuBarItems } from '../ui/menu-bar/menu-bar'
import { Button } from '../ui/button/button'
import Link from 'next/link'
import NotiDataWrapper from './noti-data-wrapper'
import { useNotificationReadMutation } from './hook'
import { useRef } from 'react'

const NotificationMenu = () => {
  return (
    <>
      <div className="inline-flex gap-4">
        <MenuBar>
          <div className="relative">
            <MenuButton
              as={Button}
              iconOnly
              ariaLabel="Open notification menu"
              size="xs"
              intent="grey"
              noScale
              className="ui-open:bg-grey-4 !border-solid !border !border-grey-5/70"
            >
              <svg
                width="19"
                height="20"
                viewBox="0 0 19 20"
                strokeWidth={0}
                fill="currentColor"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M4.45318 1.95287C5.70358 0.702467 7.39948 0 9.16782 0C10.9361 0 12.6321 0.702467 13.8825 1.95287C15.1328 3.20327 15.8353 4.89917 15.8353 6.6675V9.16782C15.8353 10.239 16.2996 10.8999 16.877 11.5543C16.9437 11.6299 17.0171 11.7107 17.0938 11.7951C17.326 12.0508 17.5886 12.3399 17.7897 12.6214C18.079 13.0263 18.3356 13.5335 18.3356 14.1684C18.3356 14.8754 17.9239 15.4252 17.4287 15.813C16.9333 16.201 16.2617 16.5067 15.4878 16.7461C13.9316 17.2276 11.7572 17.5022 9.16782 17.5022C6.5784 17.5022 4.40408 17.2276 2.84783 16.7461C2.07395 16.5067 1.40231 16.201 0.906916 15.813C0.411682 15.4252 0 14.8754 0 14.1684C0 13.5335 0.256655 13.0263 0.545915 12.6214C0.747008 12.3399 1.00959 12.0508 1.2418 11.7951C1.3185 11.7107 1.39189 11.6299 1.45865 11.5543C2.03601 10.8999 2.50031 10.239 2.50031 9.16782V6.6675C2.50031 4.89917 3.20278 3.20327 4.45318 1.95287ZM9.16782 1.66688C7.84157 1.66688 6.56964 2.19373 5.63184 3.13153C4.69404 4.06932 4.16719 5.34125 4.16719 6.6675V9.16782C4.16719 10.847 3.38133 11.8946 2.70854 12.6571C2.60029 12.7798 2.50196 12.8881 2.41187 12.9873C2.20553 13.2145 2.04243 13.3941 1.90231 13.5902C1.72276 13.8416 1.66688 14.0116 1.66688 14.1684C1.6668 14.1723 1.66434 14.289 1.93459 14.5007C2.20752 14.7144 2.66623 14.9451 3.34045 15.1537C4.68039 15.5682 6.67326 15.8353 9.16782 15.8353C11.6624 15.8353 13.6552 15.5682 14.9952 15.1537C15.6694 14.9451 16.1281 14.7144 16.401 14.5007C16.6713 14.289 16.6688 14.1723 16.6688 14.1685C16.6688 14.0117 16.6129 13.8416 16.4333 13.5902C16.2932 13.3941 16.1301 13.2145 15.9238 12.9873C15.8337 12.8881 15.7353 12.7798 15.6271 12.6571C14.9543 11.8946 14.1684 10.847 14.1684 9.16782V6.6675C14.1684 5.34125 13.6416 4.06932 12.7038 3.13153C11.766 2.19373 10.4941 1.66688 9.16782 1.66688Z"
                />
                <path d="M9.16783 18.3357C8.32523 18.3357 7.53346 18.3073 6.78837 18.2523C6.94722 18.759 7.26367 19.2018 7.69166 19.5161C8.11964 19.8305 8.6368 20 9.16783 20C9.69886 20 10.216 19.8305 10.644 19.5161C11.072 19.2018 11.3884 18.759 11.5473 18.2523C10.8022 18.3073 10.0104 18.3357 9.16783 18.3357Z" />
              </svg>
            </MenuButton>
            {/* <NotificationCount
              className="absolute -top-[10%] -right-[15%] z-50"
              count={getTotalUnreadNotis.data?.total}
            /> */}
          </div>
          <MenuBarItems className="!w-[24rem] pr-0.5 pb-0.5">
            <div>
              <div className="flex items-center justify-between pt-3.5 px-3">
                <span className="text-heading-7 text-typography-title">
                  Thông báo
                </span>
                <MenuItem as={Link} href={'/notification'} className="hidden">
                  <Button
                    intent={'grey'}
                    btnStyle="no-background"
                    iconOnly
                    ariaLabel="Open notification settings"
                  >
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="currentColor"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path d="M19.7908 13.2108C19.859 12.8108 19.8946 12.4058 19.8975 12C19.8946 11.5942 19.859 11.1892 19.7908 10.7892L21.5408 9.09833C21.6743 8.96921 21.7607 8.79922 21.7866 8.61533C21.8124 8.43145 21.776 8.24421 21.6833 8.08333L20.4333 5.91667C20.3393 5.75639 20.1949 5.63176 20.0225 5.56226C19.8502 5.49275 19.6597 5.48229 19.4808 5.5325L17.1475 6.19917C16.5157 5.68461 15.8045 5.27622 15.0417 4.99L14.4558 2.63167C14.4108 2.45131 14.3068 2.29116 14.1604 2.17671C14.0139 2.06225 13.8334 2.00005 13.6475 2H11.1475C10.9616 2.00005 10.7811 2.06225 10.6346 2.17671C10.4881 2.29116 10.3841 2.45131 10.3392 2.63167L9.74998 4.99C8.9883 5.27654 8.27822 5.68492 7.64748 6.19917L5.31415 5.5325C5.13525 5.48244 4.9448 5.49297 4.77251 5.56246C4.60022 5.63195 4.45576 5.75649 4.36165 5.91667L3.11165 8.08333C3.01872 8.2443 2.98226 8.43171 3.00808 8.61577C3.0339 8.79984 3.12052 8.96999 3.25415 9.09917L5.00415 10.79C4.93606 11.1898 4.90039 11.5945 4.89748 12C4.90034 12.4058 4.93601 12.8108 5.00415 13.2108L3.25415 14.9017C3.12071 15.0308 3.03422 15.2008 3.0084 15.3847C2.98259 15.5686 3.01893 15.7558 3.11165 15.9167L4.36165 18.0833C4.43486 18.2101 4.54019 18.3154 4.66702 18.3886C4.79386 18.4617 4.93773 18.5001 5.08415 18.5C5.16161 18.4997 5.23867 18.489 5.31332 18.4683L7.64665 17.8017C8.2784 18.3162 8.98963 18.7246 9.75248 19.0108L10.3417 21.3692C10.3867 21.549 10.4904 21.7086 10.6363 21.8229C10.7823 21.9371 10.9621 21.9994 11.1475 22H13.6475C13.8334 21.9999 14.0139 21.9377 14.1604 21.8233C14.3068 21.7088 14.4108 21.5487 14.4558 21.3683L15.045 19.01C15.8067 18.7235 16.5168 18.3151 17.1475 17.8008L19.4808 18.4675C19.5555 18.4882 19.6325 18.4988 19.71 18.4992C19.8564 18.4993 20.0003 18.4609 20.1271 18.3877C20.2539 18.3146 20.3593 18.2093 20.4325 18.0825L21.6825 15.9158C21.7754 15.7549 21.8119 15.5675 21.7861 15.3834C21.7602 15.1993 21.6736 15.0292 21.54 14.9L19.7908 13.2108ZM12.3975 15.3333C11.7382 15.3333 11.0937 15.1378 10.5456 14.7716C9.99742 14.4053 9.57018 13.8847 9.31789 13.2756C9.06559 12.6665 8.99958 11.9963 9.1282 11.3497C9.25682 10.7031 9.57429 10.1092 10.0405 9.64298C10.5066 9.1768 11.1006 8.85933 11.7472 8.73072C12.3938 8.6021 13.064 8.66811 13.6731 8.9204C14.2822 9.17269 14.8028 9.59994 15.169 10.1481C15.5353 10.6963 15.7308 11.3407 15.7308 12C15.7308 12.8841 15.3796 13.7319 14.7545 14.357C14.1294 14.9821 13.2815 15.3333 12.3975 15.3333Z" />
                    </svg>
                  </Button>
                </MenuItem>
              </div>
              <NotiDataWrapper />
            </div>
          </MenuBarItems>
        </MenuBar>
      </div>
    </>
  )
}

export default NotificationMenu
